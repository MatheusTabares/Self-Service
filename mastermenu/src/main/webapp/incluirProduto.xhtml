<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="tema.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

    <ui:define name="menu">
        <ui:include src="/includes/menuPrincipal.xhtml" />
    </ui:define>
    <h:outputScript library="js" name="script.js" />

    <ui:define name="conteudo">
        <h:form id="frmProdutoListagem">
            <p:dataTable id="tblProdutos" widgetVar="tabelaProdutos" paginator="true" 
                         emptyMessage="Nenhum produto encontrado."
                         var="produto" filteredValue="#{produtoBean.produtosFiltrados}"
                         value="#{produtosBean.itens}">

                <f:facet name="header">
                    Produto
                </f:facet>


                <p:column headerText="id" sortBy="#{produto.idProduto}" filterBy="#{produto.idProduto}">
                    <h:outputText value="#{produto.idProduto}"/>
                </p:column>

                <p:column headerText="Nome" filterBy="#{produto.nome}" sortBy="#{produto.nome}">
                    <h:outputText value="#{produto.nome}"/>
                </p:column>

                <p:column headerText="Quantidade" filterBy="#{produto.quantidade}" sortBy="#{produto.quantidade}">
                    <h:outputText value="#{produto.quantidade}"/>
                </p:column>
                
                <p:column headerText="Valor" filterBy="#{produto.valor}" sortBy="#{produto.valor}">
                    <h:outputText value="#{produto.valor}"/>
                </p:column>

                <p:column headerText="Ações">
                    <p:commandButton icon="ui-icon-circle-zoomin" oncomplete="PF('dlgProdutoConsultar').show();" update=":frmProdutoConsultar:pnlProdutoConsultar">
                        <f:setPropertyActionListener target="#{produtoBean.produto}" value="#{produto}" />
                    </p:commandButton>
                    <p:commandButton icon="ui-icon-trash" oncomplete="PF('dlgProdutoExcluir').show();" update=":frmProdutoExcluir:pnlProdutoExcluir">
                        <f:setPropertyActionListener target="#{produtoBean.produto}" value="#{produto}" />
                    </p:commandButton>
                    <p:commandButton icon="ui-icon-pencil" oncomplete="PF('dlgProdutoEditar').show();" update=":frmProdutoEditar:pnlProdutoEditar">
                        <f:setPropertyActionListener target="#{produtoBean.produto}" value="#{produto}" />
                    </p:commandButton>
                </p:column>     

                <f:facet name="footer">
                    <p:commandButton value="Novo" update=":frmProdutoNovo:pnlProdutoNovo" actionListener="#{produtoBean.preparaNovo()}" oncomplete="PF('dlgCadProduto').show();">
                        <f:setPropertyActionListener target="#{produtoBean.produto}" value="#{produto}" />
                    </p:commandButton>
                </f:facet>

            </p:dataTable>
        </h:form>
        <p:dialog widgetVar="dlgCadProduto" closable="true" 
                  header="Produto - Novo" modal="true" appendTo="@(body)" draggable="false" resizable="false">

            <h:form id="frmProdutoNovo">           
                <h:panelGrid id="pnlProdutoNovo" columns="2">
                    <p:outputLabel value="Nome:" for="txtNome"/>
                    <p:inputText id="txtNome" maxlength="50" required="true" requiredMessage="O campo nome é obrigatório." size="20" value="#{produtoBean.produto.nome}" pt:pattern="[a-z\s]+$" pt:placeholder="Entre com seu Nome">
                    </p:inputText>
                    <p:outputLabel value="Valor:" for="txtValor"/>
                    <p:inputText id="txtValor" maxlength="11" required="true" validatorMessage="Digite um valor válido no campo Valor." requiredMessage="O campo valor é obrigatório." size="15" value="#{produtoBean.produto.valor}" pt:placeholder="Entre com o Valor">
                    </p:inputText>                    
                    <p:outputLabel value="Descrição" for="txtDescricao"/>
                    <p:inputText id="txtDescricao" maxlength="50" required="true" requiredMessage="O campo Descrição é obrigatório." size="20" value="#{produtoBean.produto.descricao}"  pt:placeholder="Entre com a sua descrição">
                    </p:inputText>
                </h:panelGrid>
                <p:panelGrid columns="2">
                    <p:commandButton value="Gravar" update=":frmProdutoListagem:tblProdutos :msgGlobal" actionListener="#{produtoBean.incluirProduto}" oncomplete="verificar(xhr, status, args, 'dlgCadProduto', 'tabelaProdutos');">
                        <f:ajax render="pnlProdutoNovo" resetValues="true"/>
                        <p:resetInput id="txtNome" target="pnlProdutoNovo" />
                    </p:commandButton>
                    <p:commandButton value="Fechar" onclick="PF('dlgCadProduto').hide();"/>
                </p:panelGrid>
            </h:form>
        </p:dialog>


        <p:dialog widgetVar="dlgProdutoExcluir" header="Produto - Excluir" closable="false" draggable="false" resizable="false" modal="true" appendTo="@(body)">
            <h:form id="frmProdutoExcluir">
                <h:panelGrid id="pnlProdutoExcluir" columns="2">
                    <p:outputLabel value="Código: " />
                    <h:outputText value="#{produtoBean.produto.idProduto}" />
                    <p:outputLabel value="Nome: " />
                    <h:outputText value="#{produtoBean.produto.nome}" />
                </h:panelGrid>
                <p:commandButton value="Excluir" actionListener="#{produtoBean.excluir()}" oncomplete="PF('dlgProdutoExcluir').hide();" update=":frmProdutoListagem:tblProdutos :msgGlobal" />
                <p:commandButton value="Cancelar" onclick="PF('dlgProdutoExcluir').hide();" />
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgProdutoEditar" closable="false" draggable="false" resizable="false" modal="true" appendTo="@(body)" header="Produto - Editar">
            <h:form id="frmProdutoEditar">
                <h:panelGrid id="pnlProdutoEditar" columns="2">
                    <h:outputLabel value="Nome:" for="txtNome"/>
                    <p:inputText id="txtNome" maxlength="50" required="true" requiredMessage="O campo nome é obrigatório." size="20" value="#{produtoBean.produto.nome}" pt:pattern="[a-z\s]+$" pt:placeholder="Entre com seu Nome">

                    </p:inputText>
                    <h:outputLabel value="Produto:" for="txtProduto"/>
                    <p:inputText id="txtProduto" maxlength="50" required="true" requiredMessage="O campo Sobrenome é obrigatório." size="20" value="#{produtoBean.produto.idProduto}" pt:placeholder="Entre com o Produto">
                    </p:inputText>
                    <h:outputLabel value="Valor:" for="txtValor"/>
                    <p:inputText id="txtValor" maxlength="11" required="true" validatorMessage="Digite um valor válido no campo Valor." requiredMessage="O campo valor é obrigatório." size="15" value="#{produtoBean.produto.valor}" pt:placeholder="Entre com seu Valor">
                    </p:inputText>                    
                    <h:outputLabel value="Descrição" for="txtDescricao"/>
                    <p:inputText id="txtDescricao" maxlength="50" required="true" requiredMessage="O campo quantidade é obrigatório." size="20" value="#{produtoBean.produto.descricao}"  pt:placeholder="Entre com a sua Descrição">
                    </p:inputText>
                </h:panelGrid>
                <h:panelGrid columns="2" >
                    <p:commandButton value="Editar" actionListener="#{produtoBean.editar}" oncomplete="verificar(xhr, status, args, 'dlgProdutoEditar', 'tabelaProdutos');" update=":frmProdutoListagem:tblProdutos :msgGlobal" />
                    <p:commandButton value="Cancelar" onclick="PF('dlgProdutoEditar').hide();" />
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgProdutoConsultar" header="Produto - Consultar" closable="false" draggable="false" resizable="false" modal="true" appendTo="@(body)">
            <h:form id="frmProdutoConsultar">
                <h:panelGrid id="pnlProdutoConsultar" columns="2">
                    <h:outputLabel value="Id: " />
                    <h:outputText value="#{produtoBean.produto.idProduto}" />
                    <h:outputLabel value="Nome: " />
                    <h:outputText value="#{produtoBean.produto.nome}" />
                    <h:outputLabel value="Valor: " />
                    <h:outputText value="#{produtoBean.produto.valor}" />
                    <h:outputLabel value="Quantidade: " />
                    <h:outputText value="#{produtoBean.produto.descricao}" />
                </h:panelGrid>

                <p:commandButton value="Voltar" onclick="PF('dlgProdutoConsultar').hide();" />
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
